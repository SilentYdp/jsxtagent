<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ±Ÿè‹ä¿¡æ‰˜ Â· æ™ºèƒ½ä½“å¹³å°</title>
  <meta name="description" content="æ±Ÿè‹ä¿¡æ‰˜å…¨å…¬å¸æ™ºèƒ½ä½“ç›®å½•ã€å¯¹è¯è¯¦æƒ…ä¸è¯„åˆ†åé¦ˆã€æ•°æ®åˆ†æã€åˆè§„ä¸å‘å¸ƒç®¡ç†ã€‚"/>
  <style>
    /* ===== Apple é£æ ¼ï¼ˆä¸çŸ¥è¯†åº“å¹³å°ç»Ÿä¸€ï¼‰ï¼šæ·±è‰²æ¸å˜ + ç»ç’ƒé¢æ¿ + é«˜å¯è¯»æ€§ ===== */
    :root{
      --bg: #0b0c0f;
      --panel: rgba(255,255,255,0.08);
      --panel-strong: rgba(255,255,255,0.14);
      --border: rgba(255,255,255,0.16);
      --text: rgba(255,255,255,0.92);
      --text-dim: rgba(255,255,255,0.72);
      --accent: #0a84ff; /* Apple ç³»ç»Ÿè“ */
      --green: #30d158;
      --red: #ff453a;
      --amber: #ffd60a;
      --shadow: 0 12px 38px rgba(0,0,0,.35);
      --radius: 18px;
      --radius-lg: 22px;
      --blur: 18px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f5f6f7;
        --panel: rgba(255,255,255,0.7);
        --panel-strong: rgba(255,255,255,0.9);
        --border: rgba(0,0,0,0.08);
        --text: rgba(0,0,0,0.86);
        --text-dim: rgba(0,0,0,0.62);
        --shadow: 0 10px 30px rgba(0,0,0,.08);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display","Helvetica Neue",Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Noto Sans CJK SC","Segoe UI",Roboto,"Microsoft YaHei",sans-serif;
      background: radial-gradient(1200px 800px at 10% -10%, #1a2c46 0%, transparent 30%),
                  radial-gradient(1000px 700px at 90% 10%, #2b134f 0%, transparent 35%),
                  var(--bg);
      color:var(--text);
      letter-spacing:.2px;
    }
    a{color:var(--accent); text-decoration:none}

    /* é¡¶æ  */
    .nav{
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; gap:16px;
      padding:14px 22px;
      backdrop-filter:saturate(180%) blur(var(--blur));
      background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
      border-bottom:1px solid var(--border);
    }
    .brand{display:flex; align-items:center; gap:12px; font-weight:800}
    .logo{width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg,#6dd5ff,#0a84ff 70%); box-shadow:inset 0 0 10px rgba(255,255,255,.3), 0 4px 10px rgba(0,0,0,.2)}
    .chip{padding:6px 10px; border-radius:999px; border:1px solid var(--border); backdrop-filter:blur(10px); background:var(--panel); color:var(--text-dim); font-size:12px}
    .search{display:flex; align-items:center; gap:10px; padding:8px 12px; border:1px solid var(--border); border-radius:12px; background:var(--panel-strong)}
    .search input{flex:1; background:transparent; border:0; outline:none; color:var(--text); font-size:14px}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid var(--border); background:var(--panel-strong); color:var(--text); cursor:pointer; font-weight:600}
    .btn.primary{background:linear-gradient(180deg,#0a84ff,#0063e6); border-color:rgba(255,255,255,.2); color:#fff; box-shadow:0 8px 20px rgba(10,132,255,.33)}
    .btn.ghost{background:var(--panel)}
    .seg{display:flex; gap:8px}
    .seg button{padding:8px 12px; border-radius:10px; border:1px solid var(--border); background:var(--panel-strong); color:var(--text); cursor:pointer; font-weight:600}
    .seg button[aria-pressed="true"]{outline:2px solid color-mix(in oklab, var(--accent) 60%, transparent); box-shadow:inset 0 0 0 999px rgba(10,132,255,.1)}

    /* å®¹å™¨ä¸é¢æ¿ */
    .container{max-width:1480px; margin:0 auto; padding:18px; display:grid; gap:16px}
    .panel{background:var(--panel); backdrop-filter:saturate(180%) blur(var(--blur)); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
    .panel.pad{padding:18px}

    /* é¡µé¢ï¼ˆé¦–é¡µæç®€ + åŠŸèƒ½é¡µï¼‰ */
    .pages{display:grid; gap:16px}
    .page{display:none; gap:16px}
    .page.active{display:grid}

    /* é¦–é¡µï¼šæç®€ */
    .hero{display:grid; grid-template-columns:1fr auto; align-items:center; gap:16px; padding:22px; border-radius:var(--radius-lg)}
    .hero h1{margin:0; font-size:28px}
    .hero p{margin:6px 0 0; color:var(--text-dim)}
    .quick{display:flex; gap:10px; flex-wrap:wrap}
    .stats{display:grid; grid-template-columns:repeat(4,1fr); gap:12px}
    .stat{padding:14px; border-radius:14px; border:1px solid var(--border); background:var(--panel-strong)}
    .stat .k{font-size:22px; font-weight:800}
    .stat .t{color:var(--text-dim); font-size:12px}

    /* Agents åŠŸèƒ½é¡µ */
    .toolbar{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; padding:14px}
    .filters{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
    .select{padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:var(--panel-strong); color:var(--text)}
    .grid{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:12px; padding:14px}
    @media (max-width:1200px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
    @media (max-width:760px){ .grid{grid-template-columns:1fr} }
    .agent{display:flex; flex-direction:column; gap:12px; padding:16px; border:1px solid var(--border); border-radius:14px; background:var(--panel-strong)}
    .row{display:flex; align-items:center; gap:12px}
    .avatar{width:40px; height:40px; border-radius:12px; display:grid; place-items:center; font-weight:800; background:linear-gradient(135deg,#ffffff1a,transparent)}
    .meta{color:var(--text-dim); font-size:13px}
    .tag{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); color:var(--text-dim); margin-right:6px}
    .badge{padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border)}
    .badge.published{color:var(--green); border-color:color-mix(in oklab, var(--green) 40%, var(--border))}
    .badge.beta{color:var(--amber); border-color:color-mix(in oklab, var(--amber) 40%, var(--border))}
    .badge.draft{color:var(--text-dim)}

    /* Feedback */
    .table{overflow:hidden; border-radius:16px; border:1px solid var(--border)}
    table{width:100%; border-collapse:separate; border-spacing:0}
    thead tr{background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06))}
    th,td{padding:12px 14px; text-align:left; font-size:14px; border-bottom:1px solid var(--border)}
    tbody tr:hover{background:rgba(255,255,255,.06)}

    /* Analytics */
    .kpis{display:grid; grid-template-columns:repeat(4,1fr); gap:12px; padding:14px}
    .kpi{padding:16px; border:1px solid var(--border); border-radius:14px; background:var(--panel-strong)}
    .kpi h4{margin:0 0 6px; font-size:13px; color:var(--text-dim)}
    .kpi .num{font-size:26px; font-weight:800}
    .kpi canvas{width:100%; height:44px}

    /* è®¾ç½® */
    .kv{display:grid; grid-template-columns:180px 1fr; gap:10px 14px; padding:14px; align-items:center}

    /* è¯¦æƒ…å¼¹çª—ï¼ˆå¯¹è¯/è¯„åˆ†/ç‰ˆæœ¬/é…ç½®/åˆè§„ï¼‰ */
    dialog{border:1px solid var(--border); background:var(--panel-strong); color:var(--text); border-radius:16px; padding:0; box-shadow:var(--shadow); width:min(1020px,92vw)}
    dialog::backdrop{backdrop-filter:blur(10px); background:rgba(0,0,0,.25)}
    .sheet{display:grid; grid-template-columns:280px 1fr; min-height:60vh}
    @media (max-width:900px){ .sheet{grid-template-columns:1fr} }
    .sheet .side{border-right:1px solid var(--border)}
    .sheet-head{padding:18px 18px 0}
    .title{font-size:22px; font-weight:800; margin:0}
    .sub{color:var(--text-dim); font-size:13px}
    .tabbar{display:flex; gap:8px; padding:12px 18px; border-bottom:1px solid var(--border)}
    .tab{padding:8px 12px; border-radius:10px; border:1px solid transparent; cursor:pointer}
    .tab.active{border-color:var(--border); background:var(--panel)}
    .sheet-body{padding:18px; display:flex; flex-direction:column; gap:16px}
    .qa{display:flex; flex-direction:column; gap:12px}
    .qa-item{padding:14px; border:1px solid var(--border); border-radius:12px; background:var(--panel)}
    .qa-item .q{font-weight:700}
    .qa-item .a{margin-top:6px}
    .rate{display:flex; align-items:center; gap:6px; margin-top:8px}
    .stars{display:inline-flex; gap:2px}
    .star{width:18px; height:18px; cursor:pointer; opacity:.75}
    .star.filled{opacity:1}
    .feedback{width:100%; border:1px solid var(--border); border-radius:10px; padding:10px; background:transparent; color:var(--text)}

    .footer{padding:20px; text-align:center; color:var(--text-dim)}
    @media (prefers-reduced-motion:no-preference){
      .btn,.agent,dialog{transition:all .25s ease}
      .btn:hover{transform:translateY(-1px)}
      .agent:hover{transform:translateY(-2px)}
    }
  </style>
</head>
<body>
  <!-- é¡¶æ ï¼šå“ç‰Œ + å…¨å±€æœç´¢ï¼ˆèšç„¦å³è·³è½¬åˆ°â€œç›®å½•â€é¡µï¼‰ + å¿«é€Ÿæ“ä½œ -->
  <header class="nav" role="banner">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <span>æ±Ÿè‹ä¿¡æ‰˜ Â· æ™ºèƒ½ä½“å¹³å°</span>
    </div>
    <div class="search" role="search" style="margin-left:auto; min-width:320px; max-width:520px; flex:1;">
      <span aria-hidden="true">ğŸ”</span>
      <input id="q-global" type="text" placeholder="æœç´¢æ™ºèƒ½ä½“ã€éƒ¨é—¨ã€æ ‡ç­¾â€¦ (âŒ˜/Ctrl + K)" aria-label="æœç´¢æ™ºèƒ½ä½“"/>
    </div>
    <div class="seg" aria-label="ä¸»å¯¼èˆª" style="margin-left:8px;">
      <button class="chip" data-goto="home" aria-pressed="true">é¦–é¡µ</button>
      <button class="chip" data-goto="agents">ç›®å½•</button>
      <button class="chip" data-goto="feedback">åé¦ˆ</button>
      <button class="chip" data-goto="analytics">åˆ†æ</button>
      <button class="chip" data-goto="settings">è®¾ç½®</button>
    </div>
    <div style="margin-left:8px; display:flex; gap:8px;">
      <button class="btn primary" id="btn-new">æ–°å»ºæ™ºèƒ½ä½“</button>
      <button class="btn" id="btn-publish">å‘å¸ƒä¸­å¿ƒ</button>
      <button class="btn ghost" id="btn-settings">ç³»ç»Ÿè®¾ç½®</button>
    </div>
  </header>

  <main class="container">
    <section class="pages">
      <!-- ===== é¦–é¡µï¼ˆæç®€ï¼‰ ===== -->
      <section id="page-home" class="page active">
        <div class="panel hero">
          <div>
            <h1>ç»Ÿä¸€çš„æ™ºèƒ½ä½“ç®¡æ§ä¸æ´å¯Ÿ</h1>
            <p>æŸ¥çœ‹å…¬å¸åœ¨ç”¨æ™ºèƒ½ä½“ã€æ·±å…¥åˆ°å¯¹è¯ç»†èŠ‚å¹¶å¯è¯„åˆ†è¯„ä»·ï¼Œæ²‰æ·€æ•°æ®ä¸åˆè§„ç•™ç—•ã€‚</p>
          </div>
          <div class="quick">
            <button class="btn primary" data-goto="agents">è¿›å…¥ç›®å½•</button>
            <button class="btn" data-goto="analytics">æŸ¥çœ‹åˆ†æ</button>
            <button class="btn ghost" data-goto="feedback">å¤„ç†åé¦ˆ</button>
          </div>
        </div>

        <div class="panel pad">
          <div class="stats">
            <div class="stat"><div class="k" id="st-agents">0</div><div class="t">æ´»è·ƒæ™ºèƒ½ä½“</div></div>
            <div class="stat"><div class="k" id="st-sessions">0</div><div class="t">æœ¬å‘¨ä¼šè¯</div></div>
            <div class="stat"><div class="k" id="st-csat">0</div><div class="t">å¹³å‡æ»¡æ„åº¦</div></div>
            <div class="stat"><div class="k" id="st-resolution">0%</div><div class="t">è‡ªåŠ¨è§£å†³ç‡</div></div>
          </div>
        </div>
      </section>

      <!-- ===== ç›®å½•ï¼ˆAgentsï¼‰ ===== -->
      <section id="page-agents" class="page">
        <div class="panel toolbar">
          <div class="search">
            <span aria-hidden="true">ğŸ”</span>
            <input id="q" type="text" placeholder="æœç´¢åç§°ã€æè¿°ã€éƒ¨é—¨ã€æ ‡ç­¾â€¦" aria-label="æœç´¢ç›®å½•"/>
          </div>
          <div style="display:flex; gap:8px;">
            <select id="sort" class="select" aria-label="æ’åº">
              <option value="recent">æŒ‰æœ€è¿‘æ›´æ–°</option>
              <option value="rating">æŒ‰è¯„åˆ†</option>
              <option value="usage">æŒ‰ä½¿ç”¨é‡</option>
            </select>
          </div>
        </div>

        <div class="panel pad" style="padding-top:12px;">
          <div class="filters">
            <div>
              <label style="font-size:12px; color:var(--text-dim);">éƒ¨é—¨</label>
              <select id="f-dept" class="select">
                <option value="all">å…¨éƒ¨</option>
                <option>å®¢æœ</option><option>è¿è¥</option><option>é£æ§</option><option>æŠ•ç ”</option><option>IT</option>
              </select>
            </div>
            <div>
              <label style="font-size:12px; color:var(--text-dim);">çŠ¶æ€</label>
              <select id="f-status" class="select">
                <option value="all">å…¨éƒ¨</option>
                <option value="å·²å‘å¸ƒ">å·²å‘å¸ƒ</option>
                <option value="å†…æµ‹">å†…æµ‹</option>
                <option value="è‰ç¨¿">è‰ç¨¿</option>
              </select>
            </div>
            <div>
              <label style="font-size:12px; color:var(--text-dim);">æ¨¡å‹</label>
              <select id="f-model" class="select">
                <option value="">å…¨éƒ¨</option>
                <option>DeepSeek-R1</option><option>GPT-4o</option><option>Qwen-Max</option><option>Claude-3.5</option>
              </select>
            </div>
          </div>
        </div>

        <div class="panel grid" id="agentGrid" aria-label="æ™ºèƒ½ä½“ç›®å½•"></div>
      </section>

      <!-- ===== åé¦ˆ ===== -->
      <section id="page-feedback" class="page">
        <div class="panel pad" style="display:flex; align-items:center; justify-content:space-between;">
          <h2 style="margin:0;">ä½åˆ†åé¦ˆä¸å·¥å•</h2>
          <div>
            <button class="btn" id="exportFeedback">å¯¼å‡ºä½åˆ†åé¦ˆ</button>
          </div>
        </div>
        <div class="panel table">
          <table aria-label="ä½åˆ†åé¦ˆåˆ—è¡¨">
            <thead><tr><th>æ—¶é—´</th><th>æ™ºèƒ½ä½“</th><th>é—®é¢˜</th><th>è¯„åˆ†</th><th>å¤„ç†çŠ¶æ€</th></tr></thead>
            <tbody id="feedbackTable"></tbody>
          </table>
        </div>
      </section>

      <!-- ===== åˆ†æ ===== -->
      <section id="page-analytics" class="page">
        <div class="panel pad" style="display:flex; align-items:center; justify-content:space-between;">
          <h2 style="margin:0;">ä½¿ç”¨ä¸è´¨é‡æŒ‡æ ‡</h2>
          <div>
            <button class="btn" id="exportDashboard">å¯¼å‡ºæ•°æ®</button>
          </div>
        </div>
        <div class="panel kpis" id="kpis"></div>
      </section>

      <!-- ===== è®¾ç½® / åˆè§„ ===== -->
      <section id="page-settings" class="page">
        <div class="panel pad">
          <h2 style="margin:0 0 12px;">åˆè§„ä¸å®‰å…¨</h2>
          <div class="kv">
            <div>PIIè„±æ•</div><div><label><input type="checkbox" id="piiMask" checked/> å¯ç”¨</label></div>
            <div>å®¡è®¡æ—¥å¿—</div><div><label><input type="checkbox" id="auditLog" checked/> è®°å½•</label></div>
            <div>æç¤ºè¯å®‰å…¨</div><div><label><input type="checkbox" id="promptGuard" checked/> æ‰«æ</label></div>
            <div>æ•°æ®ä¿ç•™</div><div><select id="retention" class="select"><option>90å¤©</option><option selected>180å¤©</option><option>365å¤©</option></select></div>
          </div>
        </div>
      </section>
    </section>

    <div class="footer">Â© <span id="year"></span> æ±Ÿè‹ä¿¡æ‰˜ Â· æ™ºèƒ½ä½“å¹³å°</div>
  </main>

  <!-- ===== æ™ºèƒ½ä½“è¯¦æƒ…ï¼ˆå«å¯¹è¯è¯„åˆ†ï¼‰ ===== -->
  <dialog id="agentModal" aria-labelledby="agentTitle">
    <div class="sheet">
      <div class="side">
        <div class="sheet-head">
          <h2 class="title" id="agentTitle">æ™ºèƒ½ä½“</h2>
          <div class="sub" id="agentSub">â€”</div>
        </div>
        <div class="tabbar" role="tablist" aria-label="è¯¦æƒ…åˆ†ç»„">
          <button class="tab active" data-tab="overview">æ¦‚è§ˆ</button>
          <button class="tab" data-tab="dialog">å¯¹è¯</button>
          <button class="tab" data-tab="ratings">è¯„åˆ†</button>
          <button class="tab" data-tab="versions">ç‰ˆæœ¬</button>
          <button class="tab" data-tab="config">é…ç½®</button>
          <button class="tab" data-tab="compliance">åˆè§„</button>
        </div>
        <div style="padding:12px 18px; border-top:1px solid var(--border); display:grid; gap:10px;">
          <button class="btn primary" id="openChat">æ‰“å¼€ Chat</button>
          <button class="btn" id="exportAgent">å¯¼å‡ºè¯¥æ™ºèƒ½ä½“æ•°æ®</button>
          <button class="btn ghost" id="closeModal">å…³é—­</button>
        </div>
      </div>
      <div class="sheet-body">
        <div id="tab-overview" class="tabview">
          <div class="kv" id="overviewKV"></div>
          <canvas id="agentUsage" height="80"></canvas>
        </div>
        <div id="tab-dialog" class="tabview" hidden>
          <div class="qa" id="qaList"></div>
        </div>
        <div id="tab-ratings" class="tabview" hidden>
          <div class="table">
            <table>
              <thead><tr><th>æ—¶é—´</th><th>è¯„åˆ†</th><th>è¯„è¯­</th></tr></thead>
              <tbody id="ratingsBody"></tbody>
            </table>
          </div>
        </div>
        <div id="tab-versions" class="tabview" hidden>
          <div class="table">
            <table>
              <thead><tr><th>ç‰ˆæœ¬</th><th>è¯´æ˜</th><th>å‘å¸ƒæ—¶é—´</th></tr></thead>
              <tbody id="versionsBody"></tbody>
            </table>
          </div>
        </div>
        <div id="tab-config" class="tabview" hidden>
          <div class="kv">
            <div>åŸºç¡€æ¨¡å‹</div><div id="cfgModel"></div>
            <div>çŸ¥è¯†åº“</div><div id="cfgKB"></div>
            <div>è·¯ç”±ç­–ç•¥</div><div id="cfgRoute"></div>
            <div>è°ƒç”¨é™åˆ¶</div><div id="cfgQuota"></div>
          </div>
        </div>
        <div id="tab-compliance" class="tabview" hidden>
          <div class="kv">
            <div>PIIè„±æ•</div><div id="compPII">å·²å¼€å¯</div>
            <div>å®¡è®¡æ—¥å¿—</div><div id="compAudit">å·²å¼€å¯</div>
            <div>æç¤ºè¯å®‰å…¨</div><div id="compPrompt">å·²å¼€å¯</div>
            <div>æ•°æ®ä¿ç•™</div><div id="compRetention">180å¤©</div>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <script>
    /* ===== æ•°æ®ï¼ˆå¯æ›¿æ¢ä¸ºåç«¯æ¥å£ï¼‰ ===== */
    const agents = [
      {id:'ops-copilot', name:'è¿ç»´ Copilot', dept:'IT', owner:'ä¿¡æ¯æŠ€æœ¯éƒ¨', status:'å·²å‘å¸ƒ', model:'DeepSeek-R1', rating:4.7, usage:1820, cost:862.3, tags:['AIOps','çŸ¥è¯†åº“','è‡ªåŠ¨åŒ–'],
        desc:'IT è¿ç»´çŸ¥è¯†æ£€ç´¢ä¸è‡ªåŠ¨åŒ–æ‰§è¡Œï¼šæ—¥å¿—æ£€ç´¢ã€å˜æ›´è®°å½•ã€æ ‡å‡†åŒ–æ‰‹å†Œã€‚',
        versions:[{v:'1.3.0', note:'åŠ å…¥ CI/CD æ­¥éª¤è§£æä¸é£é™©æç¤º', time:'2025-08-20'},{v:'1.2.0', note:'æ–°å¢ Jira å·¥å•å¯¹æ¥', time:'2025-07-10'}],
        config:{kb:['è¿ç»´SOP','å˜æ›´å°è´¦','CMDB'], route:'æŒ‰æ„å›¾è·¯ç”±è‡³å·¥å…·/æ£€ç´¢/ç”Ÿæˆ', quota:'æ¯ç”¨æˆ·/æ—¥ 500 æ¬¡'},
        dialogs:[
          {q:'Nginx 502 å¦‚ä½•æ’æŸ¥ï¼Ÿ', a:'å…ˆæ£€æŸ¥ä¸Šæ¸¸æœåŠ¡ï¼š1) upstream å¥åº·ï¼›2) è¶…æ—¶ä¸è¿æ¥æ•°ï¼›3) /var/log/nginx/error.logï¼›4) å¿…è¦æ—¶å›æ»šæœ€è¿‘å˜æ›´ã€‚', t:'2025-08-26T10:21:00'},
          {q:'å¦‚ä½•å¯¼å‡ºè¿‘7å¤© K8s èŠ‚ç‚¹è´Ÿè½½ï¼Ÿ', a:'å·²ç”Ÿæˆ Grafana æŠ¥è¡¨é“¾æ¥å¹¶å¯¼å‡ºä¸º CSVï¼šå¹³å° > ç›‘æ§ä¸­å¿ƒ > èŠ‚ç‚¹è´Ÿè½½ã€‚', t:'2025-08-26T14:05:00'}]
      },
      {id:'pension-bot', name:'å…»è€ä¿¡æ‰˜å®¢æœ', dept:'å®¢æœ', owner:'å…»è€ä¿¡æ‰˜äº‹ä¸šéƒ¨', status:'å†…æµ‹', model:'GPT-4o', rating:4.3, usage:980, cost:420.1, tags:['å®¢æœ','å°ç¨‹åº','FAQ'],
        desc:'å®¢æˆ·åœ¨çº¿å’¨è¯¢ï¼šäº§å“å’¨è¯¢ã€æµç¨‹æŒ‡å¼•ã€é£é™©æç¤ºä¸è½¬äººå·¥ã€‚',
        versions:[{v:'0.9.2', note:'åŠ å…¥é£é™©æµ‹è¯„å‰ç½®é—®è¯¢', time:'2025-08-18'}],
        config:{kb:['å…»è€ä¿¡æ‰˜äº§å“æ‰‹å†Œ','åˆè§„è¯æœ¯åº“'], route:'ä¼˜å…ˆè§„åˆ™åŒ¹é…ï¼Œå…¶æ¬¡ç”Ÿæˆå›ç­”', quota:'å¹¶å‘ä¸Šé™ 50'},
        dialogs:[{q:'åŠç†å…»è€ä¿¡æ‰˜éœ€è¦å“ªäº›ææ–™ï¼Ÿ', a:'èº«ä»½è¯æ˜ã€å—ç›Šäººä¿¡æ¯ã€èµ„é‡‘æ¥æºè¯´æ˜ç­‰ï¼Œå…·ä½“ä»¥ç½‘ç‚¹æˆ–å…¬å‘Šä¸ºå‡†ã€‚', t:'2025-08-25T09:30:00'}]
      },
      {id:'risk-qa', name:'é£æ§åˆè§„é—®ç­”', dept:'é£æ§', owner:'é£é™©åˆè§„éƒ¨', status:'å·²å‘å¸ƒ', model:'Claude-3.5', rating:4.8, usage:1460, cost:610.7, tags:['åˆè§„','å®¡è®¡','æ³•è§„æ£€ç´¢'],
        desc:'å¯¹æ¥æ³•è§„åº“ä¸å†…æ§æ‰‹å†Œï¼Œæä¾›æ¡æ¬¾æ£€ç´¢ã€è§£é‡Šä¸ç•™ç—•å®¡è®¡ã€‚',
        versions:[{v:'2.1.0', note:'æ–°å¢åæ´—é’±å…³é”®è¯å‘Šè­¦', time:'2025-08-12'}],
        config:{kb:['ç›‘ç®¡æ¡ä¾‹åº“','å†…æ§åˆ¶åº¦é›†'], route:'æ³•è§„ä¼˜å…ˆ + å°‘æ ·æœ¬æç¤º', quota:'ä»…å†…ç½‘å¯ç”¨'},
        dialogs:[{q:'ç§å‹Ÿèµ„ç®¡ä¸šåŠ¡çš„é€‚å½“æ€§è¦æ±‚æœ‰å“ªäº›ï¼Ÿ', a:'åŒ…å«é£é™©æ‰¿å—èƒ½åŠ›è¯„ä¼°ã€ä¿¡æ¯æŠ«éœ²ã€å†·é™æœŸç­‰ï¼Œè¯·å‚é˜…æœ€æ–°ç›‘ç®¡æ¡æ–‡ã€‚', t:'2025-08-24T15:22:00'}]
      },
      {id:'research-analyst', name:'æŠ•ç ”ç ”æŠ¥åˆ†æ', dept:'æŠ•ç ”', owner:'æŠ•èµ„ç ”ç©¶éƒ¨', status:'è‰ç¨¿', model:'Qwen-Max', rating:4.1, usage:340, cost:95.2, tags:['ç ”æŠ¥','æ‘˜è¦','æ¯”å¯¹'],
        desc:'ä¸Šä¼ ç ”æŠ¥è‡ªåŠ¨ç”Ÿæˆæçº²ã€è¦ç‚¹æ¯”å¯¹å’Œè¡Œä¸šåœ°å›¾ã€‚',
        versions:[{v:'0.3.0', note:'åŠ å…¥ PEST ä¸äº”åŠ›æ¨¡å‹æ¨¡æ¿', time:'2025-08-22'}],
        config:{kb:['ç ”æŠ¥ä»“åº“','è´¢æŠ¥æ•°æ®'], route:'å›¾è¡¨è§£æ + ç»“æ„åŒ–æ‘˜è¦', quota:'æŒ‰éœ€ç”³è¯·'},
        dialogs:[{q:'å¯¹æ¯”ä¸¤å®¶å…‰ä¼ä¼ä¸š 24Q4 äº§èƒ½æ‰©å¼ è®¡åˆ’ã€‚', a:'å·²ç”Ÿæˆå¯¹æ¯”è¡¨ï¼Œå«äº§èƒ½ã€æˆæœ¬ã€å‡ºè´§ã€è®¢å•ç­‰ç»´åº¦ã€‚', t:'2025-08-26T11:10:00'}]
      },
      {id:'employee-assistant', name:'å‘˜å·¥äº‹åŠ¡åŠ©æ‰‹', dept:'è¿è¥', owner:'è¿è¥ç®¡ç†éƒ¨', status:'å·²å‘å¸ƒ', model:'DeepSeek-R1', rating:4.5, usage:1200, cost:310.9, tags:['æµç¨‹','OA','æŒ‡å—'],
        desc:'è¯·å‡æŠ¥é”€ã€æµç¨‹æŒ‡å¼•ã€åˆ¶åº¦æŸ¥è¯¢çš„ä¸€ç«™å¼åŠ©æ‰‹ã€‚',
        versions:[{v:'1.0.0', note:'æ­£å¼å‘å¸ƒï¼šè¦†ç›– 30+ å¸¸ç”¨æµç¨‹', time:'2025-08-15'}],
        config:{kb:['OAæµç¨‹åº“','åˆ¶åº¦æ‰‹å†Œ'], route:'FAQ ä¼˜å…ˆ + æ£€ç´¢å¢å¼º', quota:'å…¬å¸å…¨å‘˜'},
        dialogs:[{q:'å·®æ—…æŠ¥é”€éœ€è¦å“ªäº›é™„ä»¶ï¼Ÿ', a:'æœºç¥¨è¡Œç¨‹å•ã€é…’åº—å‘ç¥¨ã€å‡ºå·®å®¡æ‰¹å•ç­‰ï¼ŒæŒ‰åˆ¶åº¦ç¬¬ 3.2 æ¡æ‰§è¡Œã€‚', t:'2025-08-23T16:40:00'}]
      }
    ];

    const dashboard = {
      activeAgents: agents.length,
      weeklySessions: 4800,
      csat: 4.56,
      resolution: 0.73,
      cost: agents.reduce((s,a)=>s+a.cost,0).toFixed(1),
      history:{
        sessions:[300,420,500,610,720,900,810],
        csat:[4.2,4.3,4.4,4.5,4.6,4.5,4.56],
        cost:[220,260,300,340,380,420,460]
      }
    };

    /* ===== å·¥å…·å‡½æ•° ===== */
    const $ = (sel,root=document)=>root.querySelector(sel);
    const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
    const fmt = n => n>=1000 ? (n/1000).toFixed(1)+'k' : n;
    const fmtDate = iso => new Date(iso).toLocaleString('zh-CN');
    function escapeHTML(s){ return String(s||'').replace(/[&<>'"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;","\"":"&quot;"}[c])); }

    /* ===== é¡µé¢å¯¼èˆª ===== */
    function goto(pageId){
      $$('.seg [data-goto]').forEach(b=> b.setAttribute('aria-pressed', String(b.dataset.goto===pageId)));
      $$('.page').forEach(p=> p.classList.toggle('active', p.id==='page-'+pageId));
      if(pageId==='agents') $('#q').focus();
    }
    $$('.seg [data-goto]').forEach(b=> b.addEventListener('click', ()=> goto(b.dataset.goto)));
    $$('.quick [data-goto]').forEach(b=> b.addEventListener('click', ()=> goto(b.dataset.goto)));

    /* ===== é¡¶æ æœç´¢ï¼šèšç„¦å³è·³ç›®å½•å¹¶ç»‘å®šè¾“å…¥ ===== */
    $('#q-global').addEventListener('focus', ()=> goto('agents'));
    $('#q-global').addEventListener('input', e => { $('#q').value = e.target.value; state.q = e.target.value.trim(); applyFilters(); });
    document.addEventListener('keydown', e=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); $('#q-global').focus(); }
    });

    /* ===== ç›®å½•æ¸²æŸ“ ===== */
    const state = { q:'', sort:'recent', dept:'all', status:'all', model:'' };

    function renderAgents(list){
      const grid = $('#agentGrid');
      grid.innerHTML = list.map(a=>{
        const badge = a.status==='å·²å‘å¸ƒ'?'published':(a.status==='å†…æµ‹'?'beta':'draft');
        const initials = a.name.slice(0,2);
        return `<article class="agent" aria-labelledby="${a.id}-title">
          <div class="row">
            <div class="avatar" aria-hidden="true">${initials}</div>
            <div>
              <h3 id="${a.id}-title" style="margin:0">${a.name}</h3>
              <div class="meta">${a.dept} Â· ${a.owner} Â· è¯„åˆ† ${a.rating.toFixed(1)} Â· ä½¿ç”¨ ${fmt(a.usage)}</div>
            </div>
            <div style="margin-left:auto"><span class="badge ${badge}">${a.status}</span></div>
          </div>
          <div class="meta">æ¨¡å‹ï¼š${a.model}</div>
          <p style="margin:0">${a.desc}</p>
          <div>${a.tags.map(t=>`<span class="tag">#${t}</span>`).join('')}</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn primary" data-action="chat" data-id="${a.id}">å¯¹è¯</button>
            <button class="btn" data-action="detail" data-id="${a.id}">è¯¦æƒ…</button>
            <button class="btn ghost" data-action="publish" data-id="${a.id}">${a.status==='å·²å‘å¸ƒ'?'åœç”¨':'å‘å¸ƒ'}</button>
          </div>
        </article>`;
      }).join('');
    }

    function applyFilters(){
      let list = [...agents];
      if(state.dept!=='all') list = list.filter(a=>a.dept===state.dept);
      if(state.status!=='all') list = list.filter(a=>a.status===state.status);
      if(state.model) list = list.filter(a=>a.model===state.model);
      if(state.q){
        const q = state.q.toLowerCase();
        list = list.filter(a=> (a.name+a.dept+a.owner+a.tags.join(',')+a.desc).toLowerCase().includes(q));
      }
      if(state.sort==='rating') list.sort((a,b)=>b.rating-a.rating);
      else if(state.sort==='usage') list.sort((a,b)=>b.usage-a.usage);
      else list.sort((a,b)=> (b.versions?.[0]?.time||'').localeCompare(a.versions?.[0]?.time||''));
      renderAgents(list);
    }

    /* ===== ç«èŠ±çº¿ ===== */
    function spark(canvas, data){
      const dpr = Math.max(1, window.devicePixelRatio||1);
      const ctx = canvas.getContext('2d');
      const w = canvas.clientWidth * dpr, h = canvas.clientHeight * dpr;
      canvas.width=w; canvas.height=h; ctx.clearRect(0,0,w,h);
      const max=Math.max(...data), min=Math.min(...data);
      const pad=8*dpr; const step=(w-pad*2)/(data.length-1);
      ctx.lineWidth=2*dpr; ctx.lineJoin='round'; ctx.lineCap='round'; ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
      ctx.beginPath();
      data.forEach((v,i)=>{ const x=pad+i*step; const y=h-pad-((v-min)/(max-min||1))*(h-pad*2); i?ctx.lineTo(x,y):ctx.moveTo(x,y); });
      ctx.stroke();
    }

    /* ===== KPI æ¸²æŸ“ï¼ˆåˆ†æé¡µ + é¦–é¡µç®€æŠ¥ï¼‰ ===== */
    function renderKPIs(){
      const wrap = $('#kpis');
      wrap.innerHTML = ''
        + cardKPI('æ´»è·ƒæ™ºèƒ½ä½“', dashboard.activeAgents, dashboard.history.sessions)
        + cardKPI('æœ¬å‘¨ä¼šè¯', fmt(dashboard.weeklySessions), dashboard.history.sessions)
        + cardKPI('å¹³å‡æ»¡æ„åº¦', dashboard.csat.toFixed(2), dashboard.history.csat)
        + cardKPI('é¢„è®¡æˆæœ¬(Â¥)', dashboard.cost, dashboard.history.cost);
      $$('#kpis canvas').forEach((c,i)=> spark(c, [dashboard.history.sessions, dashboard.history.sessions, dashboard.history.csat, dashboard.history.cost][i] ));
      // é¦–é¡µç®€æŠ¥
      $('#st-agents').textContent = dashboard.activeAgents;
      $('#st-sessions').textContent = fmt(dashboard.weeklySessions);
      $('#st-csat').textContent = dashboard.csat.toFixed(2);
      $('#st-resolution').textContent = (dashboard.resolution*100).toFixed(0)+'%';
    }
    function cardKPI(title,num){ return `<div class="kpi"><h4>${title}</h4><div class="num">${num}</div><canvas></canvas></div>`; }

    /* ===== è¯¦æƒ…å¼¹çª—ï¼ˆå«è¯„åˆ†æŒä¹…åŒ–ï¼‰ ===== */
    let currentAgent=null;
    function openDetail(id){
      currentAgent = agents.find(a=>a.id===id); if(!currentAgent) return;
      $('#agentTitle').textContent = currentAgent.name;
      $('#agentSub').textContent = `${currentAgent.dept} Â· ${currentAgent.status} Â· æ¨¡å‹ ${currentAgent.model}`;
      $('#overviewKV').innerHTML = `
        <div>è´Ÿè´£äºº</div><div>${currentAgent.owner}</div>
        <div>å¹³å‡è¯„åˆ†</div><div>${currentAgent.rating.toFixed(2)}</div>
        <div>æœ¬æœˆä½¿ç”¨é‡</div><div>${fmt(currentAgent.usage)}</div>
        <div>ç´¯è®¡æˆæœ¬</div><div>Â¥${currentAgent.cost.toFixed?currentAgent.cost.toFixed(1):currentAgent.cost}</div>
        <div>æ ‡ç­¾</div><div>${currentAgent.tags.map(t=>`<span class='tag'>#${t}</span>`).join(' ')}</div>
        <div>æœ€è¿‘ç‰ˆæœ¬</div><div>${currentAgent.versions?.[0]?.v||'-'} Â· ${currentAgent.versions?.[0]?.time||''}</div>`;
      $('#cfgModel').textContent = currentAgent.model;
      $('#cfgKB').textContent = currentAgent.config.kb.join('ã€');
      $('#cfgRoute').textContent = currentAgent.config.route;
      $('#cfgQuota').textContent = currentAgent.config.quota;
      $('#compPII').textContent = $('#piiMask').checked ? 'å·²å¼€å¯' : 'æœªå¼€å¯';
      $('#compAudit').textContent = $('#auditLog').checked ? 'å·²å¼€å¯' : 'æœªå¼€å¯';
      $('#compPrompt').textContent = $('#promptGuard').checked ? 'å·²å¼€å¯' : 'æœªå¼€å¯';
      $('#compRetention').textContent = $('#retention').value || '180å¤©';

      spark($('#agentUsage'), [10,20,30,25,40,55,48].map(x=> x*(0.7+Math.random()*0.6)));

      const qa = $('#qaList');
      qa.innerHTML = currentAgent.dialogs.map((d,idx)=> renderQA(currentAgent.id, idx, d)).join('');

      const rb = $('#ratingsBody'); const rs = loadRatings(currentAgent.id);
      rb.innerHTML = rs.map(r=>`<tr><td>${fmtDate(r.t)}</td><td>${r.score} â˜…</td><td>${escapeHTML(r.note||'')}</td></tr>`).join('');

      const vb = $('#versionsBody');
      vb.innerHTML = (currentAgent.versions||[]).map(v=>`<tr><td>${v.v}</td><td>${v.note}</td><td>${v.time}</td></tr>`).join('');

      $('#agentModal').showModal();
      switchTab('overview');
    }

    function renderQA(agentId, idx, d){
      const key = `${agentId}::${idx}`;
      const saved = JSON.parse(localStorage.getItem('rating:'+key) || 'null');
      const score = saved?.score || 0; const note = saved?.note || '';
      const stars = [1,2,3,4,5].map(n=>`<svg class="star ${score>=n?'filled':''}" data-key="${key}" data-score="${n}" viewBox="0 0 24 24" aria-label="è¯„åˆ†${n}"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z" fill="currentColor"/></svg>`).join('');
      return `<div class="qa-item">
        <div class="q">Qï¼š${escapeHTML(d.q)}</div>
        <div class="a">Aï¼š${escapeHTML(d.a)}</div>
        <div class="rate"><span>è¯„åˆ†ï¼š</span><div class="stars" role="radiogroup" aria-label="ä¸ºç­”æ¡ˆæ‰“åˆ†">${stars}</div></div>
        <textarea class="feedback" data-key="${key}" rows="2" placeholder="å†™ä¸‹è¯„ä»·å¸®åŠ©æ”¹è¿›â€¦">${escapeHTML(note)}</textarea>
      </div>`;
    }

    function switchTab(id){
      $$('.tab').forEach(t=> t.classList.toggle('active', t.dataset.tab===id));
      $$('.tabview').forEach(v=> v.hidden = v.id !== 'tab-'+id);
    }

    function saveRating(key, score, note){
      localStorage.setItem('rating:'+key, JSON.stringify({score, note, t:new Date().toISOString()}));
      const all = JSON.parse(localStorage.getItem('ratings:index')||'[]');
      const idx = all.findIndex(x=>x.key===key);
      const rec = {key, score, note, agent: currentAgent?.name || key.split('::')[0], qIndex: key.split('::')[1], t:new Date().toISOString()};
      if(idx>-1) all[idx]=rec; else all.push(rec);
      localStorage.setItem('ratings:index', JSON.stringify(all));
      refreshFeedbackTable();
    }
    function loadRatings(agentId){
      const all = JSON.parse(localStorage.getItem('ratings:index')||'[]');
      return all.filter(r=> r.agent===(agents.find(a=>a.id===agentId)?.name)).sort((a,b)=>b.t.localeCompare(a.t));
    }
    function refreshFeedbackTable(){
      const tbody = $('#feedbackTable');
      const rows = JSON.parse(localStorage.getItem('ratings:index')||'[]')
        .filter(r=> r.score<=3)
        .sort((a,b)=>b.t.localeCompare(a.t))
        .map(r=> `<tr><td>${fmtDate(r.t)}</td><td>${escapeHTML(r.agent)}</td><td>ç¬¬${Number(r.qIndex)+1}æ¡é—®ç­”</td><td>${r.score}</td><td><span class="chip">å¾…å¤„ç†</span></td></tr>`)
        .join('');
      tbody.innerHTML = rows || `<tr><td colspan="5" style="text-align:center; color:var(--text-dim)">æš‚æ— ä½åˆ†åé¦ˆ</td></tr>`;
    }

    /* ===== å¯¼å‡º ===== */
    function downloadJSON(filename, data){
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download=filename; a.click(); URL.revokeObjectURL(url);
    }

    /* ===== äº‹ä»¶ç»‘å®š ===== */
    window.addEventListener('DOMContentLoaded', ()=>{
      $('#year').textContent = new Date().getFullYear();
      // é¦–é¡µç®€æŠ¥ & åˆ†æ
      renderKPIs();

      // ç›®å½•ç­›é€‰
      $('#q').addEventListener('input', e=>{ state.q = e.target.value.trim(); applyFilters(); });
      $('#sort').addEventListener('change', e=>{ state.sort = e.target.value; applyFilters(); });
      $('#f-dept').addEventListener('change', e=>{ state.dept = e.target.value; applyFilters(); });
      $('#f-status').addEventListener('change', e=>{ state.status = e.target.value; applyFilters(); });
      $('#f-model').addEventListener('change', e=>{ state.model = e.target.value; applyFilters(); });

      // åˆæ¸²æŸ“ç›®å½•
      applyFilters();

      // ç›®å½•å¡ç‰‡æŒ‰é’®
      $('#agentGrid').addEventListener('click', (e)=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const id = btn.dataset.id; const act = btn.dataset.action;
        if(act==='detail') openDetail(id);
        if(act==='chat') {/* æ­¤å¤„å¯¹æ¥å®é™… Chat è·¯ç”± */ window.open('#','_self'); }
        if(act==='publish'){ const a=agents.find(x=>x.id===id); a.status = a.status==='å·²å‘å¸ƒ'?'è‰ç¨¿':'å·²å‘å¸ƒ'; applyFilters(); }
      });

      // å¼¹çª—
      $('#closeModal').addEventListener('click', ()=> $('#agentModal').close());
      document.querySelector('.tabbar').addEventListener('click', e=>{ const t=e.target.closest('.tab'); if(t) switchTab(t.dataset.tab); });
      $('#tab-dialog').addEventListener('click', (e)=>{
        const star = e.target.closest('.star'); if(!star) return;
        const key = star.dataset.key; const score = Number(star.dataset.score);
        const parent = star.closest('.qa-item');
        parent.querySelectorAll('.star').forEach(s=> s.classList.toggle('filled', Number(s.dataset.score)<=score));
        const note = parent.querySelector('.feedback')?.value || '';
        saveRating(key, score, note);
      });
      $('#tab-dialog').addEventListener('input', (e)=>{
        const fb = e.target.closest('.feedback'); if(!fb) return;
        const key = fb.dataset.key; const parent = fb.closest('.qa-item');
        const score = [...parent.querySelectorAll('.star')].filter(s=>s.classList.contains('filled')).length;
        saveRating(key, score, fb.value);
      });

      // åé¦ˆ/å¯¼å‡º
      refreshFeedbackTable();
      $('#exportFeedback').addEventListener('click', ()=> downloadJSON('feedback-low-score.json', JSON.parse(localStorage.getItem('ratings:index')||'[]').filter(r=>r.score<=3)));
      $('#exportDashboard').addEventListener('click', ()=> downloadJSON('dashboard.json', {dashboard, agents: agents.map(a=>({id:a.id,name:a.name,usage:a.usage,rating:a.rating,cost:a.cost}))}));

      // é¡¶éƒ¨å¿«é€ŸæŒ‰é’®
      $('#btn-new').addEventListener('click', ()=> goto('agents'));
      $('#btn-publish').addEventListener('click', ()=> goto('settings'));
      $('#btn-settings').addEventListener('click', ()=> goto('settings'));
    });
  </script>
</body>
</html>
